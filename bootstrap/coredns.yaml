---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: edgecdnx-dns
  namespace: argocd
spec:
  project: edgecdnx
  source:
    chart: coredns
    repoURL: https://coredns.github.io/helm
    targetRevision: 1.42.2
    helm:
      releaseName: edgecdnx-coredns
      valuesObject:
        image:
          repository: fr6nco/coredns
          tag: 1.12.1-beta.1
        serviceType: LoadBalancer
        isClusterService: false
        replicaCount: 3
        servers:
          - port: 53
            plugins:
              - name: ready
              - name: debug
              - name: health
                configBlock: |-
                  lameduck 10s
              - name: file 
                parameters: /etc/coredns/cdn.edgecdnx.com.zone
            zones:
            - zone: "cdn.edgecdnx.com"
        zoneFiles:
          - filename: cdn.edgecdnx.com.zone
            contents: |
              $ORIGIN cdn.edgecdnx.com.
              $TTL 300

              @   IN  SOA     ns.cdn.edgecdnx.com. noc.dns.example.org. (
                      2020080302  ;Serial
                      7200        ;Refresh
                      3600        ;Retry
                      1209600     ;Expire
                      3600        ;Negative response caching TTL
              )

                          IN           NS                  ns.cdn.edgecdnx.com.
              ns          IN           A                   188.167.203.182
              eu-west-1   IN           A                   192.168.100.35
              @           IN           A                   192.168.100.20
        livenessProbe:
          enabled: true
          initialDelaySeconds: 5
          periodSeconds: 10
        readinessProbe:
          enabled: true
          initialDelaySeconds: 5
          periodSeconds: 10
  destination:
    server: "https://kubernetes.default.svc"
    namespace: edgecdnx